# SQL 絞り込み WHERE
# WHERE
## ex. id100を持っているお客様を取得する
```
SELECT * from users WHERE id = 928;
```

# WHERE解説
SELECT構文の基本は、
```
SELECT ”取得したい情報” from "テーブル名";
```

でしたね？その後ろにwhere句がつきます。
```
SELECT ”取得したい情報” from "テーブル名" WHERE "絞込をしたいcolumn名" = "foo";
```
で、条件の指定が出来ます。

# ふと疑問 「なぜSQL大文字と小文字が混在している？」
↓
https://jp.quora.com/SQL%E3%81%AE%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%81%AF%E5%A4%A7%E6%96%87%E5%AD%97%E3%81%AB%E3%81%99%E3%82%8B%E3%81%B9%E3%81%8D%E3%81%A7%E3%81%99%E3%81%8B  

「私はオブジェクト名やカラム名は小文字で書き、それ以外は大文字で書くスタイルを好んでいます。」  
「いつから、どういう経緯でこの書き方をし始めたのか覚えてません。おそらく、周囲の誰かが、このように書いているのを真似したんだと思います。」  
「MySQL と Oracle のマニュアルに載っているSQLを見てみました。マニュアルでもこの書き方になっていました。」


# 「以上」、「以下」と「より大きい」、「より小さい」
## ex. 成人(20歳以上)のusersの情報を全て取得する
```
SELECT * from users WHERE age >= 20; 
```

## 「以上」、「以下」と「より大きい」、「より小さい」解説
```
SELECT ”取得したい情報” from "テーブル名" WHERE "絞込をしたいcolumn名" >= "hogehoge";
```

|名前|説明|
|--|--|
|=|等価 (等しい) 演算子|
|<=>|	NULL 安全等価演算子|
|>|	右不等 (より多い) 演算子|
|>=|	以上 (より多いか等しい) 演算子|
|<|	左不等 (より少ない) 演算子|
|<=|	以下 (より少ないか等しい) 演算子|
|!=, <>|	不等価 (等しくない) 演算子|

補足ですが、
複数の条件を複合する場合には、"AND"を使うことによって、検索条件の追加が出来ます。

```
SELECT * from users WHERE age >= 20 AND age <= 30;
```

# BETWEEN
〇〇以上、〇〇未満の情報を取得するというケースに関して説明を致します。
上記の不等号を使っても表現することが出来ますが、BETWEENを使うことでも表現することが可能です。

## ex. 20代のusersの情報をすべて取得する
```
SELECT * FROM users WHERE age BETWEEN 20 AND 30;
```

# BETWEEN解説
```
SELECT ”取得したい情報” from "テーブル名" WHERE "絞込をしたいcolumn名" BETWEEN "最小値" AND "最大値";
```
BETWEEN句以降に最小値と最大値を指定します。
この時最小値と最大値の順番は重要です。

BETWEEN句が使えるのは、整数型を代表する、以上以下で表現が出来る型のみです。

# LIKE
部分一致で検索する例を説明致します。

## ex. mail_addressに"ky"を含むusersの情報を全て取得する
```
select * from users where mail_address like "%ky%";
```

# LIKE解説
```
SELECT ”取得したい情報” from "テーブル名" WHERE "絞込をしたいcolumn名" LIKE "%絞込をしたい文字列%";
```
LIKE句で使う"%"は、ワイルドカードと読んでおり、"%ky%"としたときには、kyを含む文字列を取得することが出来ます。
これを応用して、"ky%"と書いた時には、kyから始まる文字列の絞込が出来ます。

# 日付範囲
## ex. "2015-04-01"以前の注文を全て取得する
```
select * from orders where created_at <= "2015-04-01 00:00:00";
```

# 日付範囲解説
```
SELECT ”取得したい情報” from "テーブル名" WHERE "絞込をしたいcolumn名" <= "○○-○○-○○ ○○:○○:○○";
```
日付の絞込の際にもWHERE句を使って表現が出来ます。  
日付は、date型、datetime型などの種類を持っており、  
複雑なクエリを表現したい場合には、関数を使って表現出来ます。  
参考  
MySQLリファレンス(日付及び時間関数): https://dev.mysql.com/doc/refman/5.6/ja/date-and-time-functions.html

# INとNOT IN
配列を渡して、含む、含まないという検索について説明致します。

## ex. idが108,966,982を持っているusersの情報を全て取得する
```
select * from users where id in (108,966,982);
```

## ex. idが108,966,982を持っていないusersの情報を全て取得する
```
select * from users where id not in (108,966,982);
```

# INとNOT IN解説
```
SELECT ”取得したい情報” from "テーブル名" WHERE "絞込をしたいcolumn名" in ("指定したい情報をカンマ区切りで指定");

SELECT ”取得したい情報” from "テーブル名" WHERE "絞込をしたいcolumn名" not in ("指定したい情報をカンマ区切りで指定");
```
INで指定するときには、カンマ区切りの配列で複数の条件を指定することが出来ます。  
文字列の場合にも("foo","bar","baz")という形で指定をすることが出来ます。

# EXISTS
2つのテーブルが関係する場合の検索処理に関して解説を致します。

## ex. ordersを持っているusersの情報を全て取得する(購入履歴のあるお客様の情報を全て取得する)
```
SELECT * from users WHERE EXISTS (SELECT user_id FROM orders where users.id = orders.user_id);
```

# EXISTS解説
```
SELECT ”取得したい情報” from "テーブル名" WHERE EXISTS (SELECT "column名" FROM "判定に使うテーブル名" WHERE "テーブル名.column名" = "判定に使うテーブル名.判定に使うcolumn名");
```
SQLの中にSQLが書かれている形のことをサブクエリーと呼びます。  
サブクエリーが何なのか？という説明よりも、()の中で問い合わせた結果を使って再度検索が動いているのをイメージ出来るようになるとレベルアップ出来ると思います。

# 演習
- 東京都に住んでいる20代男性の全ての情報を取得
- 東京都渋谷区に住んでいる人の全ての情報を取得
- 今週が誕生日のusersの全ての情報を取得
- メールアドレスが"bet"で始まる人の情報を取得
- 犬の楽しい話を買っているusersの情報を全て取得

